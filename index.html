<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ClassQuest Teacher Setup</title>
    <style>
        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f7fa;
            color: #2d3748;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header h1 {
            color: #4285f4;
            margin: 0 0 10px 0;
            font-size: 2.5em;
        }

        .header p {
            color: #666;
            margin: 0;
            font-size: 1.1em;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        .section {
            background: white;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .section h2 {
            color: #2d3748;
            border-bottom: 3px solid #4285f4;
            padding-bottom: 10px;
            margin-bottom: 25px;
        }

        .form-row {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            align-items: end;
        }

        .form-group {
            flex: 1;
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #374151;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.2s;
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #4285f4;
        }

        textarea {
            resize: vertical;
            min-height: 80px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-primary {
            background: #4285f4;
            color: white;
        }

        .btn-primary:hover {
            background: #3367d6;
            transform: translateY(-1px);
        }

        .btn-success {
            background: #34a853;
            color: white;
        }

        .btn-success:hover {
            background: #2e7d32;
        }

        .btn-danger {
            background: #ea4335;
            color: white;
            padding: 6px 12px;
            font-size: 14px;
        }

        .question-list {
            max-height: 400px;
            overflow-y: auto;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            padding: 15px;
        }

        .question-item {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            position: relative;
        }

        .question-subject {
            background: #4285f4;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            text-transform: uppercase;
            margin-bottom: 8px;
            display: inline-block;
        }

        .question-text {
            font-weight: 600;
            margin-bottom: 8px;
            color: #1f2937;
        }

        .question-answer {
            color: #059669;
            font-size: 14px;
        }

        .remove-btn {
            position: absolute;
            top: 10px;
            right: 10px;
        }

        .games-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .game-checkbox {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 15px;
            background: #f8f9fa;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .game-checkbox:hover {
            border-color: #4285f4;
            background: #f0f4ff;
        }

        .game-checkbox input {
            width: auto;
            margin: 0;
        }

        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .export-section {
            text-align: center;
            padding: 40px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 12px;
        }

        .export-btn {
            background: white;
            color: #667eea;
            padding: 15px 40px;
            font-size: 18px;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            margin-top: 20px;
        }

        .export-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }

        #optionsContainer {
            display: none;
        }

        #optionsContainer.show {
            display: block;
        }

        .option-input {
            margin-bottom: 10px;
        }

        .preview {
            background: #f0f4ff;
            border: 2px dashed #4285f4;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            text-align: center;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ClassQuest Setup</h1>
            <p>Configure your classroom learning platform</p>
        </div>

        <div class="section">
            <h2>📚 Add Questions</h2>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="subject">Subject</label>
                    <select id="subject">
                        <option value="math">Mathematics</option>
                        <option value="science">Science</option>
                        <option value="english">English Language Arts</option>
                        <option value="history">Social Studies</option>
                        <option value="art">Art & Music</option>
                        <option value="pe">Physical Education</option>
                        <option value="tech">Technology</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="questionType">Question Type</label>
                    <select id="questionType" onchange="toggleOptions()">
                        <option value="multiple">Multiple Choice</option>
                        <option value="truefalse">True/False</option>
                        <option value="text">Short Answer</option>
                    </select>
                </div>
            </div>

            <div class="form-group">
                <label for="questionText">Question</label>
                <textarea id="questionText" placeholder="Enter your question here..."></textarea>
            </div>

            <div id="optionsContainer">
                <div id="multipleChoice">
                    <div class="form-group">
                        <label>Answer Choices</label>
                        <input type="text" class="option-input" id="opt1" placeholder="Option A">
                        <input type="text" class="option-input" id="opt2" placeholder="Option B">
                        <input type="text" class="option-input" id="opt3" placeholder="Option C">
                        <input type="text" class="option-input" id="opt4" placeholder="Option D">
                    </div>
                    <div class="form-group">
                        <label for="correctOption">Correct Answer</label>
                        <select id="correctOption">
                            <option value="0">Option A</option>
                            <option value="1">Option B</option>
                            <option value="2">Option C</option>
                            <option value="3">Option D</option>
                        </select>
                    </div>
                </div>

                <div id="trueFalse" style="display: none;">
                    <div class="form-group">
                        <label for="tfAnswer">Correct Answer</label>
                        <select id="tfAnswer">
                            <option value="true">True</option>
                            <option value="false">False</option>
                        </select>
                    </div>
                </div>

                <div id="textAnswer" style="display: none;">
                    <div class="form-group">
                        <label for="correctText">Correct Answer</label>
                        <input type="text" id="correctText" placeholder="Enter the correct answer">
                    </div>
                </div>
            </div>

            <button class="btn btn-primary" onclick="addQuestion()">Add Question</button>

            <div class="question-list" id="questionList">
                <div class="preview" id="noQuestions">
                    No questions added yet. Add some questions to get started!
                </div>
            </div>
        </div>

        <div class="section">
            <h2>⚙️ Platform Settings</h2>
            
            <div class="settings-grid">
                <div class="form-group">
                    <label for="energyPerQ">Energy per Correct Answer</label>
                    <input type="number" id="energyPerQ" value="5" min="1" max="20">
                </div>
                
                <div class="form-group">
                    <label for="gameCost">Energy Cost for 5min Game Time</label>
                    <input type="number" id="gameCost" value="5" min="1" max="20">
                </div>
                
                <div class="form-group">
                    <label for="startingEnergy">Starting Energy</label>
                    <input type="number" id="startingEnergy" value="50" min="10" max="100">
                </div>
                
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="allowCustomGames" checked style="width: auto; margin-right: 8px;">
                        Allow students to add custom games
                    </label>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>🎮 Available Games</h2>
            <p>Select which games students can access:</p>
            
            <div class="games-grid">
                <label class="game-checkbox">
                    <input type="checkbox" value="snow-rider" checked>
                    <span>❄️ Snow Rider 3D</span>
                </label>
                <label class="game-checkbox">
                    <input type="checkbox" value="learn-to-fly" checked>
                    <span>✈️ Learn to Fly</span>
                </label>
                <label class="game-checkbox">
                    <input type="checkbox" value="time-shooter" checked>
                    <span>🎯 Time Shooter</span>
                </label>
                <label class="game-checkbox">
                    <input type="checkbox" value="run-3" checked>
                    <span>🏃 Run 3</span>
                </label>
                <label class="game-checkbox">
                    <input type="checkbox" value="slope" checked>
                    <span>⛷️ Slope</span>
                </label>
                <label class="game-checkbox">
                    <input type="checkbox" value="geometry-dash" checked>
                    <span>🔷 Geometry Dash</span>
                </label>
                <label class="game-checkbox">
                    <input type="checkbox" value="duck-life" checked>
                    <span>🦆 Duck Life</span>
                </label>
                <label class="game-checkbox">
                    <input type="checkbox" value="papa-pizzeria" checked>
                    <span>🍕 Papa's Pizzeria</span>
                </label>
                <label class="game-checkbox">
                    <input type="checkbox" value="happy-wheels" checked>
                    <span>😄 Happy Wheels</span>
                </label>
                <label class="game-checkbox">
                    <input type="checkbox" value="tank-trouble" checked>
                    <span>🚗 Tank Trouble</span>
                </label>
            </div>
        </div>

        <div class="export-section">
            <h2>🚀 Generate Student Platform</h2>
            <p>Once you've added questions and configured settings, generate the student platform file.</p>
            <button class="export-btn" onclick="exportStudentFile()">Create Student Platform</button>
        </div>
    </div>

    <script>
        let questions = {};
        let questionCount = 0;

        function toggleOptions() {
            const type = document.getElementById('questionType').value;
            const container = document.getElementById('optionsContainer');
            
            // Hide all option types
            document.getElementById('multipleChoice').style.display = 'none';
            document.getElementById('trueFalse').style.display = 'none';
            document.getElementById('textAnswer').style.display = 'none';
            
            // Show selected type
            if (type === 'multiple') {
                document.getElementById('multipleChoice').style.display = 'block';
            } else if (type === 'truefalse') {
                document.getElementById('trueFalse').style.display = 'block';
            } else if (type === 'text') {
                document.getElementById('textAnswer').style.display = 'block';
            }
            
            container.className = 'show';
        }

        function addQuestion() {
            const subject = document.getElementById('subject').value;
            const type = document.getElementById('questionType').value;
            const questionText = document.getElementById('questionText').value.trim();

            if (!questionText) {
                alert('Please enter a question.');
                return;
            }

            let question = {
                type: type,
                question: questionText,
                id: ++questionCount
            };

            if (type === 'multiple') {
                const options = [
                    document.getElementById('opt1').value.trim(),
                    document.getElementById('opt2').value.trim(),
                    document.getElementById('opt3').value.trim(),
                    document.getElementById('opt4').value.trim()
                ];

                if (options.some(opt => !opt)) {
                    alert('Please fill in all answer options.');
                    return;
                }

                question.options = options;
                question.correct = parseInt(document.getElementById('correctOption').value);
            } else if (type === 'truefalse') {
                question.correct = document.getElementById('tfAnswer').value === 'true';
            } else if (type === 'text') {
                const answer = document.getElementById('correctText').value.trim();
                if (!answer) {
                    alert('Please enter the correct answer.');
                    return;
                }
                question.correct = answer.toLowerCase();
            }

            if (!questions[subject]) {
                questions[subject] = [];
            }
            questions[subject].push(question);

            updateQuestionList();
            clearForm();
        }

        function clearForm() {
            document.getElementById('questionText').value = '';
            document.getElementById('opt1').value = '';
            document.getElementById('opt2').value = '';
            document.getElementById('opt3').value = '';
            document.getElementById('opt4').value = '';
            document.getElementById('correctText').value = '';
        }

        function updateQuestionList() {
            const container = document.getElementById('questionList');
            const noQuestions = document.getElementById('noQuestions');
            
            if (Object.keys(questions).length === 0) {
                noQuestions.style.display = 'block';
                return;
            }
            
            noQuestions.style.display = 'none';
            container.innerHTML = '';

            Object.keys(questions).forEach(subject => {
                questions[subject].forEach((q, index) => {
                    const div = document.createElement('div');
                    div.className = 'question-item';
                    
                    let answerText = '';
                    if (q.type === 'multiple') {
                        answerText = `Answer: ${q.options[q.correct]}`;
                    } else if (q.type === 'truefalse') {
                        answerText = `Answer: ${q.correct ? 'True' : 'False'}`;
                    } else {
                        answerText = `Answer: ${q.correct}`;
                    }
                    
                    div.innerHTML = `
                        <span class="question-subject">${subject}</span>
                        <button class="btn btn-danger remove-btn" onclick="removeQuestion('${subject}', ${index})">×</button>
                        <div class="question-text">${q.question}</div>
                        <div class="question-answer">${answerText}</div>
                    `;
                    
                    container.appendChild(div);
                });
            });
        }

        function removeQuestion(subject, index) {
            questions[subject].splice(index, 1);
            if (questions[subject].length === 0) {
                delete questions[subject];
            }
            updateQuestionList();
        }

        function exportStudentFile() {
            if (Object.keys(questions).length === 0) {
                alert('Please add some questions before generating the student platform.');
                return;
            }

            const settings = {
                energyPerQuestion: parseInt(document.getElementById('energyPerQ').value),
                gameTimeCost: parseInt(document.getElementById('gameCost').value),
                startingEnergy: parseInt(document.getElementById('startingEnergy').value),
                allowCustomGames: document.getElementById('allowCustomGames').checked,
                availableGames: []
            };

            // Get selected games
            document.querySelectorAll('.game-checkbox input:checked').forEach(checkbox => {
                settings.availableGames.push(checkbox.value);
            });

            generateStudentHTML(questions, settings);
        }

        function generateStudentHTML(questionData, settingsData) {
            const studentHTML = createStudentPlatform(questionData, settingsData);
            
            const blob = new Blob([studentHTML], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'classquest-student.html';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            alert('Student platform generated successfully! The file has been downloaded.');
        }

        function createStudentPlatform(questionData, settingsData) {
            return \`<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ClassQuest - Learn & Play</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 30px;
            text-align: center;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            color: #4285f4;
            margin-bottom: 10px;
            font-size: 2.5em;
        }

        .stats-bar {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
        }

        .stat {
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 600;
            font-size: 16px;
        }

        .energy-bar {
            width: 200px;
            height: 24px;
            background: #e5e7eb;
            border-radius: 12px;
            overflow: hidden;
            position: relative;
        }

        .energy-fill {
            height: 100%;
            background: linear-gradient(90deg, #10b981, #059669);
            transition: width 0.3s ease;
            border-radius: 12px;
        }

        .energy-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 12px;
            font-weight: bold;
            color: #1f2937;
        }

        .main-content {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .nav-buttons {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .nav-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            background: #f3f4f6;
            color: #374151;
        }

        .nav-btn.active {
            background: #4285f4;
            color: white;
        }

        .nav-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        .subjects-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .subject-card {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            color: white;
            padding: 25px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
        }

        .subject-card:nth-child(2) { background: linear-gradient(135deg, #4ecdc4, #44a08d); }
        .subject-card:nth-child(3) { background: linear-gradient(135deg, #45b7d1, #2980b9); }
        .subject-card:nth-child(4) { background: linear-gradient(135deg, #96ceb4, #27ae60); }
        .subject-card:nth-child(5) { background: linear-gradient(135deg, #feca57, #ff9ff3); }
        .subject-card:nth-child(6) { background: linear-gradient(135deg, #ff9a9e, #fecfef); }
        .subject-card:nth-child(7) { background: linear-gradient(135deg, #a8edea, #fed6e3); }

        .subject-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.2);
        }

        .question-container {
            background: #f8fafc;
            border-radius: 12px;
            padding: 30px;
            margin-top: 20px;
        }

        .question-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 20px;
            color: #1f2937;
        }

        .answers-grid {
            display: grid;
            gap: 12px;
            margin-bottom: 20px;
        }

        .answer-btn {
            padding: 16px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            background: white;
            cursor: pointer;
            transition: all 0.2s;
            text-align: left;
            font-size: 16px;
        }

        .answer-btn:hover:not(:disabled) {
            border-color: #4285f4;
            background: #f0f4ff;
        }

        .answer-btn.correct {
            background: #10b981;
            color: white;
            border-color: #10b981;
        }

        .answer-btn.incorrect {
            background: #ef4444;
            color: white;
            border-color: #ef4444;
        }

        .answer-btn:disabled {
            cursor: not-allowed;
        }

        .games-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .game-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid #e5e7eb;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .game-card:hover {
            transform: translateY(-3px);
            border-color: #4285f4;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
        }

        .game-card.locked {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .game-frame {
            width: 100%;
            height: 600px;
            border: none;
            border-radius: 12px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
        }

        .timer-display {
            background: #ef4444;
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            text-align: center;
            font-weight: 600;
            margin-bottom: 20px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-primary {
            background: #4285f4;
            color: white;
        }

        .btn-primary:hover {
            background: #3367d6;
        }

        .btn-back {
            background: #6b7280;
            color: white;
            margin-bottom: 20px;
        }

        .feedback {
            margin-top: 20px;
            padding: 16px;
            border-radius: 8px;
            font-weight: 600;
            text-align: center;
        }

        .feedback.correct {
            background: #d1fae5;
            color: #065f46;
            border: 2px solid #10b981;
        }

        .feedback.incorrect {
            background: #fee2e2;
            color: #991b1b;
            border: 2px solid #ef4444;
        }

        .custom-game-section {
            margin-top: 30px;
            padding: 20px;
            background: #f8fafc;
            border-radius: 12px;
        }

        .custom-game-input {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
        }

        .custom-game-input input {
            flex: 1;
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 16px;
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .stats-bar {
                flex-direction: column;
                text-align: center;
            }
            
            .energy-bar {
                width: 250px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🎓 ClassQuest</h1>
            <p>Learn, Play, and Level Up Your Knowledge!</p>
        </div>

        <div class="stats-bar">
            <div class="stat">
                ⚡ Energy: <span id="energyCount">${settingsData.startingEnergy}</span>
                <div class="energy-bar">
                    <div class="energy-fill" id="energyBar" style="width: 100%"></div>
                    <div class="energy-text" id="energyText">${settingsData.startingEnergy}/${settingsData.startingEnergy}</div>
                </div>
            </div>
            <div class="stat">🎮 Game Time: <span id="gameTime">0</span> min</div>
            <div class="stat">📚 Answered: <span id="questionsAnswered">0</span></div>
        </div>

        <div class="main-content">
            <div class="nav-buttons">
                <button class="nav-btn active" onclick="showSection('subjects')">📚 Learn</button>
                <button class="nav-btn" onclick="showSection('games')">🎮 Play Games</button>
                <button class="nav-btn" onclick="showSection('shop')">🛒 Upgrades</button>
            </div>

            <!-- Subjects Section -->
            <div id="subjects" class="section active">
                <h2>Choose Your Subject</h2>
                <div class="subjects-grid">
                    ${Object.keys(questionData).map(subject => {
                        const subjectNames = {
                            math: { name: '📊 Mathematics', desc: 'Numbers, equations, and problem solving' },
                            science: { name: '🔬 Science', desc: 'Explore the natural world' },
                            english: { name: '📚 English', desc: 'Reading, writing, and literature' },
                            history: { name: '🏛️ Social Studies', desc: 'Past events and cultures' },
                            art: { name: '🎨 Art & Music', desc: 'Creative expression and culture' },
                            pe: { name: '⚽ Physical Ed', desc: 'Health, fitness, and sports' },
                            tech: { name: '💻 Technology', desc: 'Digital skills and computing' }
                        };
                        const info = subjectNames[subject] || { name: subject, desc: 'Questions and activities' };
                        return \`
                            <div class="subject-card" onclick="startQuiz('\${subject}')">
                                <h3>\${info.name}</h3>
                                <p>\${info.desc}</p>
                                <small>\${questionData[subject].length} questions available</small>
                            </div>
                        \`;
                    }).join('')}
                </div>
            </div>

            <!-- Games Section -->
            <div id="games" class="section">
                <h2>🎮 Game Arcade</h2>
                <p>Spend energy to unlock game time! Each \${settingsData.gameTimeCost} energy = 5 minutes of gaming.</p>
                
                <div id="gameSelection">
                    <div class="games-grid">
                        ${settingsData.availableGames.map(game => {
                            const gameInfo = {
                                'snow-rider': { name: '❄️ Snow Rider 3D', desc: 'Downhill sledding adventure' },
                                'learn-to-fly': { name: '✈️ Learn to Fly', desc: 'Help the penguin soar' },
                                'time-shooter': { name: '🎯 Time Shooter', desc: 'Slow-motion action shooter' },
                                'run-3': { name: '🏃 Run 3', desc: 'Endless space tunnel running' },
                                'slope': { name: '⛷️ Slope', desc: 'High-speed ball rolling' },
                                'geometry-dash': { name: '🔷 Geometry Dash', desc: 'Rhythm-based platformer' },
                                'duck-life': { name: '🦆 Duck Life', desc: 'Train your racing duck' },
                                'papa-pizzeria': { name: '🍕 Papa\\'s Pizzeria', desc: 'Cooking and restaurant management' },
                                'happy-wheels': { name: '😄 Happy Wheels', desc: 'Physics-based obstacle course' },
                                'tank-trouble': { name: '🚗 Tank Trouble', desc: 'Multiplayer tank battles' }
                            };
                            const info = gameInfo[game] || { name: game, desc: 'Fun game to play' };
                            return \`
                                <div class="game-card" onclick="playGame('\${game}')">
                                    <h4>\${info.name}</h4>
                                    <p>\${info.desc}</p>
                                    <small>Cost: \${settingsData.gameTimeCost} ⚡ = 5 min</small>
                                </div>
                            \`;
                        }).join('')}
                    </div>

                    ${settingsData.allowCustomGames ? \`
                    <div class="custom-game-section">
                        <h3>🌐 Add Your Own Game</h3>
                        <div class="custom-game-input">
                            <input type="url" id="customGameUrl" placeholder="Enter game website URL">
                            <input type="text" id="customGameName" placeholder="Game name">
                            <button class="btn btn-primary" onclick="addCustomGame()">Add Game</button>
                        </div>
                        <div id="customGamesList" class="games-grid"></div>
                    </div>
                    \` : ''}
                </div>

                <div id="gamePlay" style="display: none;">
                    <button class="btn btn-back" onclick="stopGame()">← Back to Games</button>
                    <div class="timer-display" id="gameTimer" style="display: none;">
                        Time Remaining: <span id="timeRemaining">5:00</span>
                    </div>
                    <iframe id="gameFrame" class="game-frame"></iframe>
                </div>
            </div>

            <!-- Shop Section -->
            <div id="shop" class="section">
                <h2>🛒 Upgrade Shop</h2>
                <p>Spend energy to unlock permanent improvements!</p>
                
                <div class="games-grid">
                    <div class="game-card" onclick="buyUpgrade('efficiency', 25)">
                        <h4>⚡ Energy Efficiency</h4>
                        <p>Get +1 extra energy per correct answer</p>
                        <small>Cost: 25 ⚡</small>
                    </div>
                    <div class="game-card" onclick="buyUpgrade('timeBoost', 35)">
                        <h4>⏰ Time Booster</h4>
                        <p>Get 2x game time for same energy cost</p>
                        <small>Cost: 35 ⚡</small>
                    </div>
                    <div class="game-card" onclick="buyUpgrade('energyTank', 50)">
                        <h4>🔋 Energy Tank</h4>
                        <p>Increase maximum energy by 20</p>
                        <small>Cost: 50 ⚡</small>
                    </div>
                </div>
            </div>

            <!-- Quiz Section -->
            <div id="quiz" class="section">
                <button class="btn btn-back" onclick="showSection('subjects')">← Back to Subjects</button>
                <div class="question-container">
                    <div class="question-title" id="questionTitle"></div>
                    <div class="answers-grid" id="answersGrid"></div>
                    <div id="feedback" class="feedback" style="display: none;"></div>
                    <button class="btn btn-primary" id="nextBtn" onclick="nextQuestion()" style="display: none;">Next Question</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let gameState = {
            energy: ${settingsData.startingEnergy},
            maxEnergy: ${settingsData.startingEnergy},
            gameTime: 0,
            questionsAnswered: 0,
            currentSubject: '',
            currentQuestionIndex: 0,
            gameTimer: null,
            upgrades: {
                efficiency: false,
                timeBoost: false,
                energyTank: false
            },
            customGames: []
        };

        const questions = ${JSON.stringify(questionData)};
        const settings = ${JSON.stringify(settingsData)};

        const gameUrls = {
            'snow-rider': 'https://advanced-channeler.surge.sh/projects/snow-rider-3d/',
            'learn-to-fly': 'https://advanced-channeler.surge.sh/projects/learn-to-fly/',
            'time-shooter': 'https://time-shooter-2.github.io/',
            'run-3': 'https://advanced-channeler.surge.sh/projects/run-3/',
            'slope': 'https://advanced-channeler.surge.sh/projects/slope/',
            'geometry-dash': 'https://advanced-channeler.surge.sh/projects/geometry-dash/',
            'duck-life': 'https://advanced-channeler.surge.sh/projects/duck-life-4/',
            'papa-pizzeria': 'https://advanced-channeler.surge.sh/projects/papas-pizzeria/',
            'happy-wheels': 'https://advanced-channeler.surge.sh/projects/happy-wheels/',
            'tank-trouble': 'https://advanced-channeler.surge.sh/projects/tank-trouble-2/'
        };

        function updateStats() {
            document.getElementById('energyCount').textContent = gameState.energy;
            document.getElementById('gameTime').textContent = gameState.gameTime;
            document.getElementById('questionsAnswered').textContent = gameState.questionsAnswered;
            
            const energyPercent = (gameState.energy / gameState.maxEnergy) * 100;
            document.getElementById('energyBar').style.width = energyPercent + '%';
            document.getElementById('energyText').textContent = \`\${gameState.energy}/\${gameState.maxEnergy}\`;
        }

        function showSection(sectionName) {
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            document.getElementById(sectionName).classList.add('active');
            event.target.classList.add('active');
        }

        function startQuiz(subject) {
            gameState.currentSubject = subject;
            gameState.currentQuestionIndex = 0;
            showSection('quiz');
            showQuestion();
        }

        function showQuestion() {
            const subjectQuestions = questions[gameState.currentSubject];
            if (gameState.currentQuestionIndex >= subjectQuestions.length) {
                alert('Amazing! You\\'ve completed all questions in this subject! 🎉');
                showSection('subjects');
                return;
            }

            const question = subjectQuestions[gameState.currentQuestionIndex];
            document.getElementById('questionTitle').textContent = question.question;
            
            const answersGrid = document.getElementById('answersGrid');
            answersGrid.innerHTML = '';
            
            document.getElementById('feedback').style.display = 'none';
            document.getElementById('nextBtn').style.display = 'none';

            if (question.type === 'multiple') {
                question.options.forEach((option, index) => {
                    const btn = document.createElement('button');
                    btn.className = 'answer-btn';
                    btn.textContent = \`\${String.fromCharCode(65 + index)}. \${option}\`;
                    btn.onclick = () => checkAnswer(index);
                    answersGrid.appendChild(btn);
                });
            } else if (question.type === 'truefalse') {
                ['True', 'False'].forEach((option, index) => {
                    const btn = document.createElement('button');
                    btn.className = 'answer-btn';
                    btn.textContent = option;
                    btn.onclick = () => checkAnswer(index === 0);
                    answersGrid.appendChild(btn);
                });
            } else if (question.type === 'text') {
                const input = document.createElement('input');
                input.type = 'text';
                input.className = 'answer-btn';
                input.placeholder = 'Type your answer here...';
                input.style.textAlign = 'center';
                input.id = 'textInput';
                input.onkeypress = (e) => {
                    if (e.key === 'Enter') {
                        checkAnswer(input.value.trim().toLowerCase());
                    }
                };
                answersGrid.appendChild(input);
                
                const submitBtn = document.createElement('button');
                submitBtn.className = 'btn btn-primary';
                submitBtn.textContent = 'Submit Answer';
                submitBtn.onclick = () => checkAnswer(input.value.trim().toLowerCase());
                answersGrid.appendChild(submitBtn);
                
                input.focus();
            }
        }

        function checkAnswer(answer) {
            const question = questions[gameState.currentSubject][gameState.currentQuestionIndex];
            let isCorrect = false;

            if (question.type === 'multiple') {
                isCorrect = answer === question.correct;
            } else if (question.type === 'truefalse') {
                isCorrect = answer === question.correct;
            } else if (question.type === 'text') {
                isCorrect = answer === question.correct.toLowerCase();
            }

            const feedback = document.getElementById('feedback');
            const answerBtns = document.querySelectorAll('.answer-btn');
            
            answerBtns.forEach(btn => {
                btn.disabled = true;
            });

            if (isCorrect) {
                feedback.textContent = '🎉 Excellent! That\\'s correct!';
                feedback.className = 'feedback correct';
                
                let energyGain = settings.energyPerQuestion;
                if (gameState.upgrades.efficiency) energyGain += 1;
                
                gameState.energy = Math.min(gameState.energy + energyGain, gameState.maxEnergy);
                gameState.questionsAnswered++;
                
                if (question.type === 'multiple') {
                    answerBtns[question.correct].classList.add('correct');
                }
            } else {
                feedback.textContent = '❌ Not quite right. Keep trying!';
                feedback.className = 'feedback incorrect';
                
                if (question.type === 'multiple') {
                    answerBtns[question.correct].classList.add('correct');
                    if (typeof answer === 'number') {
                        answerBtns[answer].classList.add('incorrect');
                    }
                }
            }

            feedback.style.display = 'block';
            document.getElementById('nextBtn').style.display = 'block';
            updateStats();
        }

        function nextQuestion() {
            gameState.currentQuestionIndex++;
            showQuestion();
        }

        function playGame(gameId) {
            const cost = settings.gameTimeCost;
            if (gameState.energy < cost) {
                alert('You need more energy! Answer questions to earn energy. ⚡');
                return;
            }

            gameState.energy -= cost;
            let timeToAdd = 5;
            if (gameState.upgrades.timeBoost) timeToAdd *= 2;
            
            gameState.gameTime += timeToAdd;
            updateStats();

            const gameFrame = document.getElementById('gameFrame');
            if (gameUrls[gameId]) {
                gameFrame.src = gameUrls[gameId];
            } else {
                const customGame = gameState.customGames.find(g => g.id === gameId);
                if (customGame) {
                    gameFrame.src = customGame.url;
                }
            }

            document.getElementById('gameSelection').style.display = 'none';
            document.getElementById('gamePlay').style.display = 'block';
            
            startGameTimer(timeToAdd);
        }

        function startGameTimer(minutes) {
            let seconds = minutes * 60;
            document.getElementById('gameTimer').style.display = 'block';
            
            gameState.gameTimer = setInterval(() => {
                seconds--;
                const mins = Math.floor(seconds / 60);
                const secs = seconds % 60;
                document.getElementById('timeRemaining').textContent = 
                    \`\${mins}:\${secs.toString().padStart(2, '0')}\`;
                
                if (seconds <= 0) {
                    clearInterval(gameState.gameTimer);
                    gameState.gameTimer = null;
                    alert('Time\\'s up! Answer more questions to play again! 🎮');
                    stopGame();
                }
            }, 1000);
        }

        function stopGame() {
            if (gameState.gameTimer) {
                clearInterval(gameState.gameTimer);
                gameState.gameTimer = null;
            }
            
            document.getElementById('gameSelection').style.display = 'block';
            document.getElementById('gamePlay').style.display = 'none';
            document.getElementById('gameTimer').style.display = 'none';
            document.getElementById('gameFrame').src = '';
        }

        function buyUpgrade(type, cost) {
            if (gameState.energy < cost) {
                alert('You need more energy for this upgrade! 💪');
                return;
            }

            if (gameState.upgrades[type]) {
                alert('You already own this upgrade! 😊');
                return;
            }

            gameState.energy -= cost;
            gameState.upgrades[type] = true;
            
            if (type === 'energyTank') {
                gameState.maxEnergy += 20;
            }

            updateStats();
            alert('Upgrade purchased! 🎉');
            
            event.target.innerHTML = '<h4>✅ Owned</h4><p>Upgrade active!</p>';
            event.target.onclick = null;
            event.target.style.opacity = '0.7';
        }

        function addCustomGame() {
            const url = document.getElementById('customGameUrl').value.trim();
            const name = document.getElementById('customGameName').value.trim();
            
            if (!url || !name) {
                alert('Please enter both a URL and game name! 📝');
                return;
            }

            const gameId = 'custom-' + Date.now();
            gameState.customGames.push({
                id: gameId,
                name: name,
                url: url
            });

            const customGamesList = document.getElementById('customGamesList');
            const gameCard = document.createElement('div');
            gameCard.className = 'game-card';
            gameCard.onclick = () => playGame(gameId);
            gameCard.innerHTML = \`
                <h4>🌐 \${name}</h4>
                <p>Custom game</p>
                <small>Cost: \${settings.gameTimeCost} ⚡ = 5 min</small>
            \`;
            customGamesList.appendChild(gameCard);

            document.getElementById('customGameUrl').value = '';
            document.getElementById('customGameName').value = '';
            
            alert('Custom game added! 🎮');
        }

        // Initialize
        updateStats();
    </script>
</body>
</html>\`;
        }

        // Initialize the teacher interface
        document.addEventListener('DOMContentLoaded', function() {
            toggleOptions();
        });
    </script>
</body>
</html>
