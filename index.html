<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>7th Grade Quiz & Game Portal</title>
  <style>
    body { font-family: sans-serif; margin: 0; padding: 20px; }
    .hidden { display: none; }
    button { margin: 5px; }
    .bottom-right { position: fixed; bottom: 10px; right: 10px; }
    #dev-panel { background: #eee; padding: 10px; border: 1px solid #333; }
    textarea { width: 100%; }
    #upgrade-section button { display: block; margin: 5px 0; }
  </style>
</head>
<body>
  <h1>7th Grade Quiz & Game Portal</h1>
  <div id="mode-select">
    <button id="btn-teacher">Teacher Mode</button>
    <button id="btn-student">Student Mode</button>
  </div>

  <!-- TEACHER MODE -->
  <div id="teacher-mode" class="hidden">
    <h2>Teacher Mode</h2>
    <label>Subject: <input type="text" id="new-subject"></label><br>
    <label>Type:
      <select id="new-type">
        <option value="tf">True/False</option>
        <option value="mc">Multiple Choice</option>
        <option value="txt">Text Input</option>
      </select>
    </label><br>
    <label>Question Text: <br><input type="text" id="new-text" style="width:100%"></label><br>
    <div id="mc-options" class="hidden">
      <label>Option A: <input type="text" id="optA"></label><br>
      <label>Option B: <input type="text" id="optB"></label><br>
      <label>Option C: <input type="text" id="optC"></label><br>
      <label>Option D: <input type="text" id="optD"></label><br>
    </div>
    <label>Answer: <input type="text" id="new-answer"></label><br>
    <button id="add-q">Add Question</button>
    <h3>Existing Questions</h3>
    <div id="q-list" style="max-height: 200px; overflow-y: auto; border:1px solid #ccc; padding:5px;"></div>
    <button id="export-student">Export Student Version</button><br>
    <textarea id="exported-html" rows="10" readonly></textarea>
  </div>

  <!-- STUDENT MODE -->
  <div id="student-mode" class="hidden">
    <h2>Student Mode</h2>
    <div>Energy: <span id="energy">0</span> | Energy per Q: <span id="energy-per-q">10</span> | Game Cost: <span id="game-cost">20</span></div>
    <div id="question-area">
      <h3 id="q-subject"></h3>
      <p id="q-text"></p>
      <div id="q-response"></div>
      <button id="btn-submit">Submit Answer</button>
    </div>
    <div id="upgrade-section">
      <h3>Upgrades</h3>
      <button id="buy-bonus-energy">+5 Energy per Q (Cost: 100)</button>
      <button id="buy-cheaper-games">-5 Game Cost (Cost: 150)</button>
    </div>
    <div id="games">
      <h3>Games</h3>
      <div id="game-buttons"></div>
      <h4>Add Custom Game URL</h4>
      <input type="text" id="custom-url" placeholder="Enter iframe URL">
      <button id="add-custom">Add Custom Game</button>
      <div id="iframe-container"></div>
    </div>
  </div>

  <!-- Dev panel trigger -->
  <div class="bottom-right">
    <input id="secret-code" placeholder="Type code">
  </div>
  <div id="dev-panel" class="hidden">
    <h3>DEV PANEL</h3>
    <button id="dev-energy">+500 Energy</button>
    <button id="dev-infinite">Infinite Energy/Time</button>
    <button id="dev-multiplier">Double Energy Earn</button>
  </div>

  <script>
    // State
    let questions = [];
    const SEED_Q_COUNT = 2000;
    let energy = 0;
    let energyPerQ = 10;
    let gameCost = 20;
    let currentQ = null;
    let infiniteMode = false;
    let doubleEnergy = false;

    const teacherModeDiv = document.getElementById('teacher-mode');
    const studentModeDiv = document.getElementById('student-mode');

    // Mode switching
    document.getElementById('btn-teacher').onclick = () => {
      teacherModeDiv.classList.remove('hidden');
      studentModeDiv.classList.add('hidden');
    };
    document.getElementById('btn-student').onclick = () => {
      studentModeDiv.classList.remove('hidden');
      teacherModeDiv.classList.add('hidden');
      if (questions.length === 0) seedQuestions();
      loadQuestion();
      renderGames();
    };

    // When question type changes, show options
    document.getElementById('new-type').onchange = function() {
      document.getElementById('mc-options').classList.toggle('hidden', this.value !== 'mc');
    };

    // Add question in teacher mode
    document.getElementById('add-q').onclick = () => {
      const subj = document.getElementById('new-subject').value;
      const type = document.getElementById('new-type').value;
      const text = document.getElementById('new-text').value;
      const answer = document.getElementById('new-answer').value;
      if (!subj || !text || !answer) return alert('All fields required');
      let q = { subject: subj, type, text, answer };
      if (type === 'mc') {
        q.options = [
          document.getElementById('optA').value,
          document.getElementById('optB').value,
          document.getElementById('optC').value,
          document.getElementById('optD').value
        ];
        if (q.options.includes('')) return alert('MC options cannot be empty');
      }
      questions.push(q);
      renderQuestionList();
      alert('Question added.');
    };

    function renderQuestionList() {
      const list = document.getElementById('q-list');
      list.innerHTML = '';
      questions.forEach((q,i) => {
        const div = document.createElement('div');
        div.textContent = `${i+1}. [${q.subject}] ${q.text}`;
        list.appendChild(div);
      });
    }

    // Export as student HTML
    document.getElementById('export-student').onclick = () => {
      const payload = {
        questions: questions,
        seedCount: 0
      };
      const html = `
<!DOCTYPE html>
<html lang="en">
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>Student Version</title></head><body>
<script>
  const questions = ${JSON.stringify(questions)};
  // (Then copy full student-mode logic from this file to here)
  alert('Embed full student-mode script manually.');
</script>
</body></html>`;
      document.getElementById('exported-html').value = html.trim();
    };

    // Seed many dummy questions
    function seedQuestions() {
      const subjects = ['Math','Science','English','History','Geography','Art','Music'];
      for (let i = 0; i < SEED_Q_COUNT; i++) {
        let subj = subjects[i % subjects.length];
        questions.push({
          subject: subj,
          type: 'tf',
          text: `Seed question #${i+1}: Is this statement true?`,
          answer: 'true'
        });
      }
    }

    // STUDENT MODE: display and handle questions
    const energySpan = document.getElementById('energy');
    const epqSpan = document.getElementById('energy-per-q');
    const gcSpan = document.getElementById('game-cost');
    const qSubjDiv = document.getElementById('q-subject');
    const qTextP = document.getElementById('q-text');
    const qRespDiv = document.getElementById('q-response');
    document.getElementById('btn-submit').onclick = submitAnswer;

    function loadQuestion() {
      currentQ = questions[Math.floor(Math.random() * questions.length)];
      qSubjDiv.textContent = `Subject: ${currentQ.subject}`;
      qTextP.textContent = currentQ.text;
      qRespDiv.innerHTML = '';
      if (currentQ.type === 'tf') {
        qRespDiv.innerHTML = '<button data-val="true">True</button><button data-val="false">False</button>';
      } else if (currentQ.type === 'mc') {
        currentQ.options.forEach(opt => qRespDiv.innerHTML += `<button data-val="${opt}">${opt}</button>`);
      } else {
        qRespDiv.innerHTML = '<input id="txt-a"><button id="txt-sub">Submit</button>';
      }
      Array.from(qRespDiv.querySelectorAll('button[data-val]')).forEach(btn => {
        btn.onclick = () => {
          qRespDiv.querySelectorAll('button').forEach(b => b.classList.remove('sel'));
          btn.classList.add('sel');
        };
      });
      if (currentQ.type === 'txt') {
        document.getElementById('txt-sub').onclick = submitAnswer;
      }
    }

    function submitAnswer() {
      let resp = '';
      if (currentQ.type === 'txt') resp = document.getElementById('txt-a').value.trim();
      else resp = qRespDiv.querySelector('.sel')?.getAttribute('data-val');
      if (!resp) return alert('No answer selected.');
      const correct = resp.toLowerCase() === currentQ.answer.toLowerCase();
      if (correct) {
        let gain = infiniteMode ? (doubleEnergy ? energyPerQ * 2 : energyPerQ) : energyPerQ;
        energy += gain;
        alert(`Correct! +${gain} energy`);
      } else {
        alert('Incorrect.');
      }
      energySpan.textContent = infiniteMode ? '∞' : energy;
      loadQuestion();
    }

    // Upgrades
    document.getElementById('buy-bonus-energy').onclick = () => {
      if (energy >= 100) {
        energy -= 100;
        energyPerQ += 5;
        epqSpan.textContent = energyPerQ;
        energySpan.textContent = energy;
      } else alert('Not enough energy.');
    };
    document.getElementById('buy-cheaper-games').onclick = () => {
      if (energy >= 150) {
        energy -= 150;
        gameCost = Math.max(5, gameCost - 5);
        gcSpan.textContent = gameCost;
        energySpan.textContent = energy;
      } else alert('Not enough energy.');
    };

    // Games
    const games = [
      { name: 'Snow Rider', url: 'https://www.crazygames.com/embed/snow-rider-3d' },
      { name: 'Learn to Fly', url: 'https://www.crazygames.com/embed/learn-to-fly' },
      { name: 'Time Shooter', url: 'https://www.crazygames.com/embed/time-shooter' },
    ];
    const gButtonsDiv = document.getElementById('game-buttons');
    const iframeDiv = document.getElementById('iframe-container');
    document.getElementById('add-custom').onclick = () => {
      const u = document.getElementById('custom-url').value.trim();
      if (u) { games.push({ name: 'Custom', url: u }); renderGames(); document.getElementById('custom-url').value = ''; }
    };
    function renderGames() {
      gButtonsDiv.innerHTML = '';
      games.forEach((g,i) => {
        const btn = document.createElement('button');
        btn.textContent = `Play: ${g.name} (-${gameCost} energy)`;
        btn.onclick = () => {
          if (infiniteMode || energy >= gameCost) {
            if (!infiniteMode) energy -= gameCost;
            energySpan.textContent = infiniteMode ? '∞' : energy;
            iframeDiv.innerHTML = `<iframe src="${g.url}" width="800" height="600"></iframe>`;
          } else alert('Not enough energy.');
        };
        gButtonsDiv.appendChild(btn);
      });
    }

    // Dev panel trigger
    document.getElementById('secret-code').oninput = function() {
      if (this.value === 'quincysayhi') document.getElementById('dev-panel').classList.remove('hidden');
    };
    document.getElementById('dev-energy').onclick = () => { energy += 500; energySpan.textContent = infiniteMode ? '∞' : energy; };
    document.getElementById('dev-infinite').onclick = () => { infiniteMode = !infiniteMode; energySpan.textContent = infiniteMode ? '∞' : energy; };
    document.getElementById('dev-multiplier').onclick = () => { doubleEnergy = !doubleEnergy; };

  </script>
</body>
</html>
